---
import BaseLayout from '../layouts/BaseLayout.astro';
import ChessStats from '../components/chesscom.tsx';
const pageTitle = "My Stats";

import Strava from "../components/strava.js";
import fontColorContrast from "font-color-contrast";
import ErrorRenderer from "../Error.astro";

let data, error
try {
  const strava = new Strava()
  data = await strava.fetch()
} catch (e) {
  error = e.message
  if (error.includes("401")) {
    throw Error(
      "Something went wrong with the Strava API, try updating your refresh_token",
    )
  }
}

const bgColor = "#41ab5d";
const color = "#0000FF";
---

<BaseLayout pageTitle={pageTitle}>
  <h2>Check out my stats&#x1F60E</h2>
  <ChessStats client:load />

  <h3>Total distance I've swamğŸŠ, bikedğŸš´, and runğŸƒâ€â™‚ï¸ this year</h3>
  <h4>(data from Strava)</h4>
  {
    !error && (
      <html id="html" lang="en" class="no-mobile no-js">
        <head>
          <meta charset="UTF-8" />
        </head>
        <body>
          <a
            href={data.url}
            target="_blank"
            rel="noopener noreferrer"
            class="widget flex items-start gap-2 w-80 overflow-hidden relative select-none py-2"
            style={`background: ${bgColor}`}
          >
            <img class="widget-pic" src={data.image} />
            <div class="flex flex-col">
              <span class="widget-text">{data.copy}</span>
              <h1 class="h1">{data.title}</h1>
            </div>
          </a>
        </body>
      </html>
    )
  }
  <ErrorRenderer error={error} />
  
  <style define:vars={{ color }}>
    .widget {
      //color: var(--color);
      fill: var(--color);
    }
  </style>
</BaseLayout>
