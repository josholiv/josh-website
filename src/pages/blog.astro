---
import { getCollection } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";
import BlogPost from "../components/BlogPost.astro";
import BlogSorter from "../components/BlogSorter.astro";

const pageTitle = "Blog";
const allPosts = await getCollection("blog");

const sortedPosts = allPosts.sort(
  (a, b) => new Date(b.data.pubDate) - new Date(a.data.pubDate) // default: newest first
);
---

<BaseLayout pageTitle={pageTitle}>
 <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
    <a href="/tags" class="tag-index-link">#Tag Index</a>
    <BlogSorter client:load />
  </div>

  <hr style="margin-bottom: 1rem;" />

  <ul>
    {
      sortedPosts.map((post) => (
        <BlogPost 
          url={`/posts/${post.id}/`} 
          title={post.data.title} 
          image={post.data.image} 
          pubDate={post.data.pubDate}
        />
      ))
    }
  </ul>
</BaseLayout>
